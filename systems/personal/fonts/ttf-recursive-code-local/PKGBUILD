# shellcheck shell=bash disable=SC2034,2154
pkgname=ttf-recursive-code-local
pkgver=$(curl -sS https://api.github.com/repos/arrowtype/recursive/releases/latest | jq -r .tag_name)
pkgrel=1
pkgdesc="Recursive Code Local"
arch=(any)
makedepends=(git python python-virtualenv python-pip)
conflicts=(ttf-recursive otf-recursive)

package() {
    rm -rf recursive-code-config
    git clone https://github.com/arrowtype/recursive-code-config.git
    cd recursive-code-config || exit 1
    python3 -m venv venv
    # shellcheck disable=SC1091
    source venv/bin/activate
    pip install --upgrade pip
    pip install -r requirements.txt
    fontTemplate=$(find font-data -name Recursive_* | head -1)
    variants=(casual duotone linear semicasual casual_liga duotone_liga linear_liga semicasual_liga)
    for variant in "${variants[@]}"; do
        python3 scripts/instantiate-code-fonts.py ../../"${variant}".yaml "${fontTemplate}" &
    done
    wait
    mkdir -p "${pkgdir}"/usr/share/fonts/TTF/
    cp -r fonts/* "${pkgdir}"/usr/share/fonts/TTF
}