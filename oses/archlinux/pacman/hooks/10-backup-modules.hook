[Trigger]
Operation = Install
Operation = Upgrade
Operation = Remove
Type = Path
Target = usr/lib/modules/*/vmlinuz

[Action]
Description = Backing up kernel modules...
Depends = pacman
Depends = sh
Depends = coreutils
When = PreTransaction
Exec = /bin/sh -c 'if [[ -d "/usr/lib/modules/$(uname -r)" ]]; then mkdir -p "/usr/lib/modules/backup"; cp -r "/usr/lib/modules/$(uname -r)" "/usr/lib/modules/backup/$(uname -r)"; fi'
